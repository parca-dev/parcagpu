# Mock CUDA Runtime Implementation

This directory contains a mock implementation of libcudart for testing the parcagpu library without requiring an actual NVIDIA GPU or CUDA installation.

## Files

- `mock_cudart.c` - Mock implementation of CUDA runtime functions
- `Makefile` - Build script for the mock library
- `test_mock.c` - Simple test program to verify the mock works
- `libcudart.so` - Built mock library (generated by `make`)

## Implemented Functions

The mock library implements the following CUDA runtime functions used by the Rust code:

- `cudaEventCreateWithFlags` - Creates CUDA events with timestamps
- `cudaEventRecord` - Records event timestamps
- `cudaEventSynchronize` - Simulates event synchronization
- `cudaEventElapsedTime` - Calculates elapsed time between events
- `cudaStreamIsCapturing` - Always returns "not capturing"
- `cudaLaunchKernel` - Simulates kernel launches

## Building

To build the mock library:

```bash
make mock-cudart
```

To clean up build artifacts:

```bash
make clean
```

## Usage

### With the Rust Project

To build the parcagpu library using the mock CUDA runtime:

```bash
LD_LIBRARY_PATH=. cargo build --release
```

To run tests with the mock:

```bash
LD_LIBRARY_PATH=. cargo test
```

### Testing the Mock Directly

To test the mock implementation directly:

```bash
gcc -o test_mock test_mock.c -L. -lcudart
LD_LIBRARY_PATH=. ./test_mock
```

## Features

- **Realistic timing simulation**: Events record actual timestamps and calculate realistic elapsed times
- **Debug output**: All function calls are logged to help with debugging
- **Error handling**: Returns appropriate CUDA error codes for invalid parameters
- **Memory management**: Properly allocates and manages event structures
- **Thread safety**: Basic thread-safe operations for event timing

## Limitations

- No actual GPU computation is performed
- Kernel launches are simulated with fixed delays
- Stream management is minimal
- Error conditions are simplified
- No device memory management